[![Build Status](https://travis-ci.org/lae/ansible-role-netbox.svg?branch=master)](https://travis-ci.org/lae/ansible-role-netbox)
[![Galaxy Role](https://img.shields.io/badge/ansible--galaxy-netbox-blue.svg)](https://galaxy.ansible.com/lae/netbox/)

lae.netbox
=========

Installs and configures DigitalOcean's NetBox.

Requirements
------------

### Database

You'll need to setup a PostgreSQL server and create a database user separately
from this role. This role will check and attempt to create a database itself if
it doesn't already exist. The example playbook provides an excellent, tested
example of deploying Postgres locally with this role, giving the database user
CREATEDB permissions (which aren't needed if you create the database yourself).

Role Variables
--------------

To enable a stable release, set `netbox_stable` to `true` (mutually exclusive
with `netbox_git` - only one can be set to `true`). You can also pin a specific
version with `netbox_stable_version`, or download a different NetBox tarball
with `netbox_stable_uri`.

To deploy NetBox via git, set `netbox_git` to `true`. You can select a specific
commit, branch or tag by setting `netbox_git_version` to a valid ref, and you
can use a different git repository by defining `netbox_git_uri`.

By default, Python 3 will be used for deployment. Set `netbox_python` to 2 in
order to use Python 2.

See the *Example Playbook* section for more information on configuring the DB.

`netbox_secret_key`, if left undefined, will be generated by this role and (by
default) stored in `/srv/netbox/shared/generated_secret_key`. This will then be
used by the role to configure NetBox unless `netbox_secret_key` is later defined.

`netbox_bind_address` is the address Gunicorn will be configured to listen on.

`netbox_allowed_hosts` is a list defining `ALLOWED_HOSTS`.

To load the initial data shipped by NetBox, set `netbox_load_initial_data` to
true. Otherwise, this role will deploy NetBox with an empty slate.


Example Playbook
----------------

The following installs PostgreSQL and creates a user with @geerlingguy's robust
Postgres role, then proceeds to deploy and configure NetBox using a local unix
socket to authenticate with the Postgres server.

    - hosts: netbox.idolactiviti.es
      become: yes
      roles:
         - geerlingguy.postgresql
         - lae.netbox
      vars:
         netbox_stable: true
         netbox_database_socket: "{{ postgresql_unix_socket_directories[0] }}"
         netbox_allowed_hosts:
           - netbox.idolactiviti.es
         postgresql_users:
           - name: "{{ netbox_database_user }}"
             role_attr_flags: CREATEDB,NOSUPERUSER

Assuming you have a PG server already running with the user `netbox_prod_user`
created, it owns a database called `netbox_prod`, and it allows the host you're
installing NetBox on to authenticate with it over TCP:

    - hosts: netbox.idolactiviti.es
      become: yes
      roles:
         - lae.netbox
      vars:
         netbox_stable: true
         netbox_allowed_hosts:
           - netbox.idolactiviti.es
         netbox_database_host: pg-netbox.idolactiviti.es
         netbox_database_port: 15432
         netbox_database_name: netbox_prod
         netbox_database_user: netbox_prod_user
         netbox_database_password: "very_secure_password_for_prod"

